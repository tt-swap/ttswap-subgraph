specVersion: 1.0.0
description: ttswap is a decentralized protocol for automated token exchange on Ethereum.
indexerHints:
  prune: auto
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum/contract
    name: MarketManager
    network: mainnet
    source:
      address: "0xB05BFcb8E46fdF3660ED62479d0b44D5f9320e3e"
      abi: MarketManager
      startBlock: 5785546
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/marketmanage.ts
      entities:
        - Customer
        - MarketState
        - GoodState
        - ParGoodState
        - ProofState
        - Transaction
        - GoodData
        - ParGoodData
        - MarketData
      abis:
        - name: MarketManager
          file: ./abis/MarketManager.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: ERC20NameBytes
          file: ./abis/ERC20NameBytes.json
        - name: ERC20SymbolBytes
          file: ./abis/ERC20SymbolBytes.json
      callHandlers:
        #init
        - function: initMetaGood(address,uint256,uint256)
          handler: handle_fn_initMetaGood
        - function: initNormalGood(uint256,uint256,address,uint256,address)
          handler: handle_fn_initNormalGood
        #valueGood
        - function: investValueGood(uint256,uint128,address)
          handler: handle_fn_investValueGood
        - function: disinvestValueGood(uint256,uint128,address)
          handler: handle_fn_disinvestValueGood
        - function: disinvestValueProof(uint256,uint128,address)
          handler: handle_fn_disinvestValueProof
        #nomalgood
        - function: investNormalGood(uint256,uint256,uint128,address)
          handler: handle_fn_investNormalGood
        - function: disinvestNormalGood(uint256,uint256,uint128,address)
          handler: handle_fn_disinvestNormalGood
        - function: disinvestNormalProof(uint256,uint128,address)
          handler: handle_fn_disinvestNormalProof
        # banlist
        - function: addbanlist(address)
          handler: handle_fn_addbanlist
        - function: removebanlist(address)
          handler: handle_fn_removebanlist
        # goodconfig
        - function: updatetoValueGood(uint256)
          handler: handle_fn_updatetoValueGood
        - function: updatetoNormalGood(uint256)
          handler: handle_fn_updatetoNormalGood
        - function: updateGoodConfig(uint256,uint256)
          handler: handle_fn_updateGoodConfig
        # marketconfig
        - function: setMarketConfig(uint256)
          handler: handle_fn_setMarketConfig
        # relation
        - function: addreferer(address)
          handler: handle_fn_addReferer
      eventHandlers:  
        - event: e_proof(indexed uint256)
          handler: handle_e_updateProof
        - event: e_buyGood(indexed uint256,indexed uint256,address,uint128,uint256,uint256)
          handler: handle_e_buyGood
        - event: e_buyGoodForPay(indexed uint256,indexed uint256,address,address,uint128,uint256,uint256)
          handler: handle_e_buyGoodForPay
        

